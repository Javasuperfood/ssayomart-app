<<<<<<<<<<<<<<  ✨ Codeium Command ⭐ >>>>>>>>>>>>>>>>
public function handleAppleLoginResponse()
{
    $appleService = new \App\Libraries\AppleSignInService();
    $usersModel = new \App\Models\UsersModel();

    try {
        // Mendapatkan authorization code dari request
        $code = $this->request->getVar('code');

        if (!$code) {
            throw new \Exception('Authorization code not found in the request.');
        }

        // Menggunakan library/service untuk mendapatkan user data dari Apple
        $userData = $appleService->getUserData($code);

        // Pastikan bahwa data yang diterima valid
        if (!$userData || !isset($userData['id_token'])) {
            throw new \Exception('Invalid user data received from Apple.');
        }

        // Menyimpan atau memperbarui pengguna berdasarkan data yang diterima
        $userId = $usersModel->saveUserFromAppleID($userData);

        if ($userId) {
            // Set user session atau handle lanjutan setelah sukses login
            $this->setUserSession($userId);
            return redirect()->to('/dashboard'); // Redirect ke halaman dashboard
        } else {
            // Handle error saat login gagal
            throw new \Exception('Failed to save or update the user.');
        }
    } catch (\Exception $e) {
        // Handle exception dan tampilkan pesan error jika terjadi kesalahan
        log_message('error', $e->getMessage()); // Log the error for debugging purposes
        return redirect()->back()->with('error', 'An error occurred during Apple ID login: ' . $e->getMessage());
    }
}
<<<<<<<  466677be-3618-4330-a9b9-a70d7503be06  >>>>>>>
class AppleCallback extends BaseController
{
public function handleAppleLoginResponse()
{
$appleService = new \App\Libraries\AppleSignInService();
$usersModel = new \App\Models\UsersModel();

try {
// Mendapatkan authorization code dari request
$code = $this->request->getVar('code');

// Menggunakan library/service untuk mendapatkan user data dari Apple
$userData = $appleService->getUserData($code);

// Menyimpan atau memperbarui pengguna berdasarkan data yang diterima
$userId = $usersModel->saveUserFromAppleID($userData);

if ($userId) {
// Set user session atau handle lanjutan setelah sukses login
// Setiap aplikasi memiliki cara yang berbeda untuk handle login
$this->setUserSession($userId);
return redirect()->to('/dashboard'); // Redirect ke halaman dashboard
} else {
// Handle error saat login gagal
return redirect()->back()->with('error', 'Login menggunakan Apple ID gagal.');
}
} catch (\Exception $e) {
// Handle exception dan tampilkan pesan error jika terjadi kesalahan
return redirect()->back()->with('error', $e->getMessage());
}
}

private function setUserSession($userId)
{
$session = session();
// Simpan data sesi pengguna setelah berhasil login
// Contoh:
$session->set('logged_in', true);
$session->set('user_id', $userId);
// Tambahkan data sesi lainnya sesuai kebutuhan
}
}

// Jangan lupa untuk menambahkan route untuk handle login response dari Apple
// Tambahkan pada file app/Config/Routes.php
// $routes->get('apple-login-response', 'AppleCallback::handleAppleLoginResponse');
<<<<<<< f35552bb-6d68-422e-a32a-0886ab3eb724>>>>>>>